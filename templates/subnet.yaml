AWSTemplateFormatVersion: 2010-09-09
Description: >
  This template specifies a subnet for a VPC.
Metadata:
  AWS::CloudFormation::Interface:
    ParameterGroups:
      - Label:
          default: Subnet Configuration
        Parameters:
          - AvailabilityZone
          - CidrBlock
          - MapPublicIpOnLaunch
          - NameTag
          - VpcId
    ParameterLabels:
      AvailabilityZone:
        default: Availability Zone
      CidrBlock:
        default: IPv4 CIDR Block
      MapPublicIpOnLaunch:
        default: Map Public IP on Launch
      NameTag:
        default: Name Tag
      VpcId:
        default: VPC ID
Parameters:
  AvailabilityZone:
    Type: String
    Description: >
      The Availability Zone of the subnet.
  CidrBlock:
    Type: String
    AllowedPattern: '((\d{1,3})\.){3}\d{1,3}/\d{1,2}'
    Description: The IPv4 CIDR block assigned to the subnet.
  MapPublicIpOnLaunch:
    Type: String
    AllowedValues:
      - false
      - true
    Default: false
    Description: >
      Indicates whether instances launched in this subnet receive a public IPv4 address. 
  NameTag:
    Type: String
    Description: >
      A tag with a key of 'Name' and a value that you specify.
  VpcId:
    Type: AWS::EC2::VPC::Id
    ConstraintDescription: >
      VPC ID is required.
    Description: >
      The ID of the VPC the subnet is in.
    MinLength: 1
Conditions:
  HasNameTag:  !Not [ !Equals [ !Ref NameTag, "" ] ]
Resources:
  Subnet:
    Type: AWS::EC2::Subnet
    Properties: 
      AvailabilityZone: !Ref AvailabilityZone
      CidrBlock: !Ref CidrBlock
      MapPublicIpOnLaunch: !Ref MapPublicIpOnLaunch
      Tags: 
        !If 
          - HasNameTag
          - Key: "Name"
            Value: !Ref NameTag
          - []
      VpcId: !Ref VpcId
Outputs:
  SubnetId:
    Value: !Ref Subnet